# 🎤 语音识别测试工具使用指南

## 📋 概述

为了帮助诊断视频拉片分析中字幕识别的问题，我们创建了一个独立的语音识别测试工具。这个工具可以：

- ✅ 测试百度语音识别API是否正常工作
- ✅ 查看详细的音频处理过程
- ✅ 显示完整的API请求和响应信息
- ✅ 帮助定位问题所在

---

## 🚀 如何使用

### 访问测试工具

在浏览器中访问：`/audio-test` 路径

或者点击导航栏中的"语音识别测试"链接

---

## 🎯 测试步骤

### 方法1：录音测试

1. **打开浏览器控制台**
   - 按 `F12` 键
   - 切换到 **Console（控制台）** 标签

2. **开始录音**
   - 点击"开始录音"按钮
   - 允许浏览器访问麦克风
   - 清晰地说一段话（建议5-10秒）
   - 使用标准普通话

3. **停止录音**
   - 点击"停止录音"按钮
   - 系统会自动开始处理和识别

4. **查看结果**
   - 在页面上查看识别结果
   - 在控制台查看详细的处理日志
   - 查看调试信息卡片

### 方法2：上传文件测试

1. **准备测试文件**
   - 准备一个包含人声的音频或视频文件
   - 建议使用短视频（10-30秒）

2. **上传文件**
   - 点击"上传音频/视频"按钮
   - 选择文件
   - 系统会自动开始处理

3. **查看结果**
   - 查看识别结果和调试信息

---

## 🔍 查看调试信息

### 页面上的调试信息

测试工具会显示以下信息：

```
=== 调试信息 ===

原始音频: audio/webm, 123456 字节
音频时长: 8.50 秒
WAV大小: 272044 字节
Base64长度: 362726 字符

API响应:
- status: 0
- msg: success
- data.err_no: 0
- data.err_msg: success.
- data.result: ["你好，这是一段测试语音"]
```

### 控制台日志

控制台会输出更详细的信息：

```
🎤 请求麦克风权限...
✅ 麦克风权限已获取
音频轨道设置: {sampleRate: 16000, channelCount: 1, ...}
🔴 录音中...
📦 收到音频数据块: 12345 字节
⏹️ 录音停止
📼 录音完成，大小: 123456 字节

=== 🔄 开始音频转换和识别 ===
原始音频格式: audio/webm
原始音频大小: 123456 字节
ArrayBuffer大小: 123456 字节
✅ 音频解码成功
- 时长: 8.50 秒
- 采样率: 16000 Hz
- 声道数: 1
- 样本数: 136000
✅ WAV转换完成
- WAV大小: 272044 字节
- WAV类型: audio/wav
✅ Base64编码完成
- Base64长度: 362726 字符
- Base64前100字符: UklGRvwDBABXQVZFZm10IBAAAAABA...

📡 调用语音识别API
请求参数:
- format: wav
- rate: 16000
- len: 272044
- speech长度: 362726

📥 API响应:
{
  "status": 0,
  "msg": "success",
  "data": {
    "corpus_no": "7368634167330515968",
    "err_no": 0,
    "err_msg": "success.",
    "sn": "123456789",
    "result": ["你好，这是一段测试语音"]
  }
}

✅ 识别成功: 你好，这是一段测试语音
```

---

## ✅ 成功的标志

### 识别成功

如果看到以下内容，说明语音识别功能正常：

**页面显示：**
```
识别结果
你好，这是一段测试语音
```

**控制台显示：**
```
✅ 识别成功: 你好，这是一段测试语音
```

**调试信息显示：**
```
- data.err_no: 0
- data.err_msg: success.
- data.result: ["你好，这是一段测试语音"]
```

---

## ❌ 常见问题

### 问题1：err_no = 3301

**显示：**
```
识别失败: speech quality problem (err_no: 3301)
```

**原因：** 音频质量问题

**可能的情况：**
- 录音时没有说话（静音）
- 音量太小
- 背景噪音过大
- 音频质量差

**解决方案：**
- 重新录音，确保清晰地说话
- 提高音量
- 在安静的环境中录音
- 使用标准普通话

### 问题2：err_no = 3302

**显示：**
```
识别失败: authentication failed (err_no: 3302)
```

**原因：** API鉴权失败

**解决方案：**
- 检查 `.env` 文件中的 `VITE_APP_ID` 是否正确
- 确认API配置正确

### 问题3：识别结果为空

**显示：**
```
- data.result: []
```

**原因：** 音频中没有识别到语音内容

**解决方案：**
- 确保录音时有清晰的人声
- 检查麦克风是否正常工作
- 尝试提高音量

### 问题4：音频解码失败

**显示：**
```
❌ 处理失败: Failed to decode audio data
```

**原因：** 音频格式不支持或文件损坏

**解决方案：**
- 使用常见的音频格式（MP3、WAV、M4A）
- 确保文件没有损坏
- 尝试使用其他文件

---

## 🎬 测试建议

### 推荐的测试内容

**简单测试：**
```
"你好"
"今天天气真好"
"一二三四五"
```

**中等测试：**
```
"大家好，欢迎观看今天的视频"
"这是一个语音识别测试"
"北京科技馆位于朝阳区"
```

**复杂测试：**
```
"人工智能技术正在改变我们的生活，
语音识别作为其中的重要应用，
已经广泛应用于各个领域"
```

### 测试环境要求

- ✅ 安静的环境
- ✅ 清晰的发音
- ✅ 标准普通话
- ✅ 适中的音量
- ✅ 良好的麦克风

---

## 🔧 对比测试

### 测试工具 vs 视频拉片分析

如果测试工具能正常识别，但视频拉片分析不能，说明问题可能在于：

1. **视频音频提取**
   - 视频文件的音频轨道可能有问题
   - 音频编码格式不兼容

2. **音频分割**
   - 分割后的音频段可能有问题
   - 时间戳匹配可能有误

3. **批量处理**
   - 批量识别时的错误处理
   - 并发请求的问题

### 如果测试工具也不能识别

说明问题在于：

1. **API配置**
   - 检查API URL是否正确
   - 检查APP_ID是否正确

2. **音频格式**
   - 检查音频转换是否正确
   - 检查采样率是否为16000Hz

3. **网络问题**
   - 检查网络连接
   - 检查API是否可访问

---

## 📊 诊断流程图

```
开始测试
    ↓
能否录音？
    ├─ 否 → 检查麦克风权限
    └─ 是 ↓
        ↓
音频解码成功？
    ├─ 否 → 检查音频格式
    └─ 是 ↓
        ↓
WAV转换成功？
    ├─ 否 → 检查转换代码
    └─ 是 ↓
        ↓
API调用成功？
    ├─ 否 → 检查网络和API配置
    └─ 是 ↓
        ↓
err_no = 0？
    ├─ 否 → 查看err_msg，根据错误码处理
    └─ 是 ↓
        ↓
result不为空？
    ├─ 否 → 检查音频内容（可能无人声）
    └─ 是 ↓
        ↓
    识别成功！✅
```

---

## 💡 使用技巧

### 1. 对比测试

- 先用测试工具测试简单的录音
- 确认API正常后，再测试视频拉片分析
- 对比两者的日志输出

### 2. 逐步排查

- 从简单到复杂
- 从短音频到长音频
- 从清晰语音到复杂场景

### 3. 保存日志

- 截图控制台日志
- 复制调试信息
- 记录错误代码

### 4. 多次测试

- 测试不同的语音内容
- 测试不同的音频长度
- 测试不同的音频质量

---

## 📝 报告问题

如果测试工具仍然无法识别，请提供以下信息：

### 必需信息

1. **控制台完整日志**
   - 从"🎤 请求麦克风权限"开始
   - 到最后的识别结果或错误信息

2. **调试信息截图**
   - 页面上显示的调试信息卡片

3. **API响应**
   - status值
   - err_no值
   - err_msg内容

4. **测试环境**
   - 浏览器类型和版本
   - 操作系统
   - 测试内容（说了什么）

### 可选信息

- 音频文件（如果是上传测试）
- 视频文件（如果是视频拉片分析）
- 网络环境
- 其他相关信息

---

## 🎯 下一步

### 如果测试工具正常

说明API配置正确，问题可能在视频拉片分析的音频提取部分：

1. 检查视频文件是否有音频轨道
2. 检查音频提取代码
3. 检查音频分割逻辑
4. 查看视频拉片分析的控制台日志

### 如果测试工具也失败

说明API本身有问题：

1. 检查API配置
2. 检查网络连接
3. 检查音频格式转换
4. 联系技术支持

---

## 🔗 相关文档

- [AUDIO_DEBUG_GUIDE.md](AUDIO_DEBUG_GUIDE.md) - 音频识别调试指南
- [QUICK_AUDIO_CHECK.md](QUICK_AUDIO_CHECK.md) - 快速音频检查
- [AUDIO_SUBTITLE_OPTIMIZATION.md](AUDIO_SUBTITLE_OPTIMIZATION.md) - 音频字幕优化说明

---

## ✅ 检查清单

使用测试工具前：

- [ ] 打开浏览器控制台（F12）
- [ ] 清空之前的日志
- [ ] 准备好测试内容
- [ ] 确保麦克风正常工作
- [ ] 确保在安静的环境中

测试过程中：

- [ ] 观察控制台日志
- [ ] 查看页面提示信息
- [ ] 记录错误信息
- [ ] 截图保存结果

测试完成后：

- [ ] 查看识别结果
- [ ] 查看调试信息
- [ ] 分析err_no和err_msg
- [ ] 确定问题原因

---

**文档版本：** v1.0  
**创建日期：** 2025-12-03  
**工具路径：** `/audio-test`  
**状态：** ✅ 可用
