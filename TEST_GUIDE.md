# 测试指南 - 视频分析功能

## 🎯 测试目的

验证视频分析功能是否正常工作，并确保错误处理和日志系统完善。

---

## 📋 测试前准备

### 1. 准备测试视频

建议准备以下类型的视频：

| 类型 | 时长 | 格式 | 大小 | 用途 |
|------|------|------|------|------|
| 短视频 | 10秒 | MP4 | <5MB | 快速测试 |
| 标准视频 | 30秒 | MP4 | 10-20MB | 正常测试 |
| 长视频 | 60秒 | MP4 | 20-50MB | 压力测试 |

### 2. 打开开发者工具

1. 打开浏览器（推荐Chrome或Edge）
2. 按 **F12** 键
3. 点击 **Console** 标签
4. 勾选 **Preserve log**（保留日志）

### 3. 清空控制台

点击控制台左上角的 🚫 图标清空之前的日志

---

## ✅ 测试场景1：正常流程测试

### 测试步骤

1. **上传视频**
   - 点击上传区域
   - 选择一个10-30秒的MP4视频
   - 确认视频信息显示正确

2. **开始分析**
   - 点击"开始分析"按钮
   - 观察进度条变化
   - 观察控制台日志输出

3. **查看结果**
   - 等待分析完成
   - 查看分镜分析结果
   - 尝试生成提示词

### 预期结果

#### 控制台日志应该显示：
```
✓ 正在提取视频关键帧...
✓ 开始分析 8 个镜头
✓ 正在分析第 1/8 个镜头，时间戳: 0秒
✓ 提交第 1 个镜头的图像分析请求...
✓ 图像数据长度: XXXXX 字符
✓ 请求参数: { hasImage: true, ... }
✓ 响应状态: 200 OK
✓ 图像分析响应: { status: 0, ... }
✓ 第 1 个镜头提交成功，任务ID: task_xxx
✓ 开始轮询任务结果
✓ 轮询尝试 1/30
✓ 任务状态码: 1 (处理中)
✓ 任务处理中，等待 2000ms 后重试...
✓ 轮询尝试 2/30
✓ 任务状态码: 0 (完成)
✓ 第 1 个镜头分析完成
✓ 分析结果: ...
✓ 进度更新: 36.2%
... (重复8次)
✓ 视频分析完成！
```

#### 页面应该显示：
- ✅ 进度条从0%到100%
- ✅ 显示分镜分析表格
- ✅ 显示视频总结
- ✅ 可以生成提示词

### 测试通过标准
- [ ] 进度条正常更新
- [ ] 控制台有详细日志
- [ ] 分析结果正确显示
- [ ] 没有错误提示

---

## ❌ 测试场景2：错误处理测试

### 测试2.1：网络错误模拟

#### 测试步骤
1. 打开开发者工具
2. 切换到 **Network** 标签
3. 勾选 **Offline**（离线模式）
4. 上传视频并点击"开始分析"

#### 预期结果
```
❌ 图像分析请求失败: Failed to fetch
❌ HTTP错误: Failed to fetch
❌ submitImageUnderstanding 发生错误
❌ 分析第 1 帧失败: Failed to fetch
❌ 视频分析失败: Failed to fetch
```

#### 页面应该显示
- ❌ Toast错误提示："视频分析失败，请检查网络连接后重试"
- ❌ 进度条停止
- ❌ 分析按钮恢复可用

### 测试2.2：视频格式错误

#### 测试步骤
1. 尝试上传不支持的格式（如.txt文件）
2. 或上传损坏的视频文件

#### 预期结果
- 应该有友好的错误提示
- 不应该崩溃

### 测试2.3：超时测试

#### 测试步骤
1. 使用一个很长的视频（>5分钟）
2. 观察是否会超时

#### 预期结果
```
❌ 图像分析超时，请稍后重试
```

---

## 🔍 测试场景3：日志完整性测试

### 检查项目

#### 1. 请求日志
- [ ] 显示图像数据长度
- [ ] 显示请求参数信息
- [ ] 显示当前处理的镜头序号

#### 2. 响应日志
- [ ] 显示响应状态码
- [ ] 显示响应数据
- [ ] 显示任务ID

#### 3. 进度日志
- [ ] 显示轮询尝试次数
- [ ] 显示任务状态码
- [ ] 显示进度百分比

#### 4. 错误日志
- [ ] 显示错误类型
- [ ] 显示错误消息
- [ ] 显示错误堆栈（如果有）
- [ ] 显示错误详情对象

---

## 📊 测试记录表

### 测试环境
- 浏览器：____________
- 版本：____________
- 操作系统：____________
- 网络环境：____________

### 测试结果

| 测试场景 | 测试结果 | 备注 |
|---------|---------|------|
| 正常流程 - 10秒视频 | ☐ 通过 ☐ 失败 | |
| 正常流程 - 30秒视频 | ☐ 通过 ☐ 失败 | |
| 正常流程 - 60秒视频 | ☐ 通过 ☐ 失败 | |
| 网络错误处理 | ☐ 通过 ☐ 失败 | |
| 视频格式错误 | ☐ 通过 ☐ 失败 | |
| 超时处理 | ☐ 通过 ☐ 失败 | |
| 日志完整性 | ☐ 通过 ☐ 失败 | |

### 发现的问题

| 问题描述 | 严重程度 | 复现步骤 | 控制台日志 |
|---------|---------|---------|-----------|
| | ☐ 高 ☐ 中 ☐ 低 | | |
| | ☐ 高 ☐ 中 ☐ 低 | | |
| | ☐ 高 ☐ 中 ☐ 低 | | |

---

## 🎯 性能测试

### 测试指标

| 指标 | 目标值 | 实际值 | 是否达标 |
|------|--------|--------|---------|
| 10秒视频分析时间 | <2分钟 | _____ | ☐ 是 ☐ 否 |
| 30秒视频分析时间 | <4分钟 | _____ | ☐ 是 ☐ 否 |
| 60秒视频分析时间 | <8分钟 | _____ | ☐ 是 ☐ 否 |
| 内存占用 | <500MB | _____ | ☐ 是 ☐ 否 |
| CPU占用 | <80% | _____ | ☐ 是 ☐ 否 |

### 性能优化建议

根据测试结果，记录性能瓶颈和优化建议：

1. ___________________________________
2. ___________________________________
3. ___________________________________

---

## 🐛 问题报告模板

如果发现问题，请按以下格式报告：

### 问题标题
简短描述问题

### 问题描述
详细描述问题现象

### 复现步骤
1. 第一步
2. 第二步
3. 第三步

### 预期结果
应该发生什么

### 实际结果
实际发生了什么

### 控制台日志
```
粘贴完整的控制台日志
```

### 截图
附上相关截图

### 环境信息
- 浏览器：
- 版本：
- 操作系统：
- 视频信息：

---

## ✅ 测试完成检查清单

### 功能测试
- [ ] 视频上传功能正常
- [ ] 关键帧提取成功
- [ ] API调用成功
- [ ] 分析结果正确显示
- [ ] 提示词生成成功

### 错误处理
- [ ] 网络错误有提示
- [ ] API错误有提示
- [ ] 格式错误有提示
- [ ] 超时有提示
- [ ] 错误信息清晰明确

### 日志系统
- [ ] 每个步骤都有日志
- [ ] 日志信息详细
- [ ] 错误日志完整
- [ ] 可以定位问题

### 用户体验
- [ ] 进度显示清晰
- [ ] 加载状态明确
- [ ] 错误提示友好
- [ ] 操作流畅

### 文档完整性
- [ ] 有使用指南
- [ ] 有调试指南
- [ ] 有故障排查文档
- [ ] 有API文档

---

## 📞 测试支持

### 遇到问题？

1. **查看文档**
   - [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - 故障排查
   - [HOW_TO_DEBUG.md](HOW_TO_DEBUG.md) - 调试指南
   - [FIX_ANALYSIS_ISSUE.md](FIX_ANALYSIS_ISSUE.md) - 修复报告

2. **收集信息**
   - 控制台完整日志
   - 视频文件信息
   - 错误截图
   - 操作步骤

3. **联系支持**
   - 提供上述信息
   - 详细描述问题
   - 说明预期结果

---

## 📝 测试总结

### 测试日期
_______________

### 测试人员
_______________

### 测试结论
☐ 全部通过  
☐ 部分通过  
☐ 未通过

### 总体评价
_______________________________________________
_______________________________________________
_______________________________________________

### 改进建议
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

**文档版本：** v1.0  
**创建日期：** 2025-12-03  
**更新日期：** 2025-12-03  
**状态：** ✅ 可用
