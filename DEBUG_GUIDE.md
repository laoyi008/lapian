# 调试指南

## 问题：进度条卡在30%

### 已添加的调试功能

#### 1. 详细的控制台日志
现在每个关键步骤都会在浏览器控制台输出日志，帮助定位问题：

**音频分析阶段（0-30%）：**
- 音频提取和识别的错误信息

**画面分析阶段（30-80%）：**
- `开始分析 X 个镜头` - 显示总共要分析的镜头数
- `正在分析第 X/Y 个镜头，时间戳: Z秒` - 显示当前处理的镜头
- `提交第 X 个镜头的图像分析请求...` - API请求开始
- `第 X 个镜头提交成功，任务ID: xxx` - API请求成功
- `等待第 X 个镜头的分析结果...` - 开始轮询结果
- `轮询尝试 X/Y` - 显示轮询进度
- `任务状态码: X` - 显示任务状态
- `第 X 个镜头分析完成` - 单个镜头完成
- `进度更新: X%` - 显示当前进度

**错误日志：**
- 详细的错误信息和堆栈跟踪
- HTTP错误状态码
- API返回的错误消息

#### 2. 增强的错误提示
- 用户界面会显示具体的错误信息
- 不再只是"跳过该帧"，而是显示具体错误原因

### 如何调试

#### 步骤1：打开浏览器开发者工具
1. 按 `F12` 或右键点击页面选择"检查"
2. 切换到"Console"（控制台）标签页

#### 步骤2：上传视频并开始分析
1. 上传一个短视频（建议10-30秒）
2. 点击"开始分析"按钮
3. 观察控制台输出

#### 步骤3：查看日志定位问题

**如果卡在30%，检查以下日志：**

1. **是否看到"开始分析 X 个镜头"？**
   - ✅ 看到了：说明音频分析完成，进入画面分析阶段
   - ❌ 没看到：说明在音频分析阶段就卡住了

2. **是否看到"提交第 1 个镜头的图像分析请求..."？**
   - ✅ 看到了：说明开始调用图像分析API
   - ❌ 没看到：说明在准备阶段就出错了

3. **是否看到"第 1 个镜头提交成功，任务ID: xxx"？**
   - ✅ 看到了：说明API调用成功
   - ❌ 没看到：说明API调用失败，查看错误信息

4. **是否看到轮询日志"轮询尝试 X/Y"？**
   - ✅ 看到了：说明在等待API返回结果
   - ❌ 没看到：说明提交后就卡住了

5. **任务状态码是什么？**
   - `0`：任务完成
   - `1`：任务处理中（正常）
   - 其他：任务失败

### 常见问题和解决方案

#### 问题1：API调用失败（HTTP错误）
**症状：** 看到"HTTP错误: XXX"
**原因：** 网络问题或API服务不可用
**解决：** 
- 检查网络连接
- 稍后重试
- 联系技术支持

#### 问题2：任务一直处理中
**症状：** 看到很多"轮询尝试"，但任务状态码一直是1
**原因：** API处理时间过长
**解决：**
- 等待更长时间（最多60秒）
- 尝试更短的视频
- 检查视频质量是否过高

#### 问题3：任务失败
**症状：** 任务状态码不是0或1
**原因：** API返回错误
**解决：**
- 查看错误消息
- 检查视频格式是否支持
- 尝试其他视频

#### 问题4：所有帧分析均失败
**症状：** 看到"所有帧分析均失败"错误
**原因：** 每个镜头的分析都失败了
**解决：**
- 查看每个镜头失败的具体原因
- 检查视频是否损坏
- 尝试重新上传

### 性能优化建议

1. **视频长度**：建议使用10-30秒的短视频
2. **视频质量**：不需要4K，720p或1080p即可
3. **网络环境**：确保网络稳定
4. **浏览器**：建议使用Chrome或Edge最新版本

### 技术细节

#### 进度计算
- 0-10%: 提取关键帧
- 10-30%: 音频分析
- 30-80%: 画面分析（每个镜头占 50/镜头数 %）
- 80-85%: 生成整体分析
- 85-100%: 完成

#### API调用流程
1. 提交图像分析请求 → 获得任务ID
2. 轮询任务结果（每2秒一次，最多30次）
3. 任务完成 → 返回分析结果
4. 解析结果 → 提取结构化信息

#### 超时设置
- 单个任务最长等待时间：60秒（30次 × 2秒）
- 如果超时，会跳过该镜头继续分析下一个

### 需要帮助？

如果按照以上步骤仍无法解决问题，请：
1. 截图控制台的完整日志
2. 记录视频的基本信息（时长、格式、大小）
3. 描述具体的错误现象
4. 联系技术支持
