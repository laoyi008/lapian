# 个人中心功能说明

## 功能概述

在导航栏中添加了个人中心按钮，用户可以查看和管理个人资料、生成历史（24小时内）和积分明细。

## 实现内容

### 1. 页面创建

创建了 `src/pages/Profile.tsx` 个人中心页面，包含三个主要功能模块：

#### 个人资料模块
- **功能**：查看和编辑个人信息
- **字段**：
  - 用户名
  - 手机号
  - 邮箱
- **验证**：
  - 手机号格式验证（11位，以1开头）
  - 邮箱格式验证
- **操作**：保存修改后自动刷新用户信息

#### 生成历史模块
- **功能**：查看最近24小时内的视频分析记录
- **显示内容**：
  - 操作类型（视频分析、提示词生成等）
  - 消耗积分
  - 视频时长
  - 相对时间（刚刚、X分钟前、X小时前）
- **数据筛选**：自动过滤24小时以外的记录

#### 积分明细模块
- **功能**：查看所有积分收支记录
- **显示内容**：
  - 交易类型（充值、消费、管理员操作、赠送）
  - 积分变动金额
  - 交易描述
  - 交易后余额
  - 相对时间
- **视觉区分**：
  - 收入类型：绿色图标和徽章
  - 支出类型：红色图标和灰色徽章

### 2. 路由配置

在 `src/routes.tsx` 中添加了个人中心路由：

```typescript
{
  name: '个人中心',
  path: '/profile',
  element: <Profile />,
  visible: true
}
```

### 3. 导航栏更新

在 `src/components/common/Header.tsx` 中添加了个人中心按钮：

- **位置**：积分显示和用户名之间
- **图标**：User 图标
- **响应式**：
  - 桌面端：显示"个人中心"文字
  - 移动端：仅显示图标
- **样式**：ghost 按钮样式，与其他按钮保持一致

### 4. 用户体验优化

#### 页面头部
- 显示用户头像（圆形图标）
- 用户名和角色徽章
- 注册时间
- 当前积分（大号显示）

#### 标签页切换
- 三个标签页：个人资料、生成历史、积分明细
- 点击标签时自动加载对应数据
- 加载状态显示（旋转图标）

#### 空状态提示
- 无生成记录时显示友好提示
- 无积分记录时显示友好提示
- 使用图标和文字组合

#### 时间格式化
- **相对时间**：刚刚、X分钟前、X小时前
- **绝对时间**：完整日期时间（YYYY-MM-DD HH:mm:ss）
- **视频时长**：MM:SS 格式

#### 视觉设计
- 卡片式布局
- 科技感边框和背景
- 悬停效果
- 颜色区分不同类型的交易

## 使用说明

### 访问个人中心

1. **通过导航栏**
   - 登录后，点击导航栏中的"个人中心"按钮
   - 或点击用户图标

2. **通过路由**
   - 直接访问 `/profile` 路径

### 查看个人资料

1. 默认显示"个人资料"标签
2. 查看当前的用户名、手机号、邮箱
3. 修改信息后点击"保存修改"按钮
4. 系统会验证输入格式
5. 保存成功后显示提示

### 查看生成历史

1. 点击"生成历史"标签
2. 系统自动加载最近24小时的记录
3. 查看每条记录的详细信息：
   - 操作类型
   - 消耗积分
   - 视频时长（如果有）
   - 操作时间

### 查看积分明细

1. 点击"积分明细"标签
2. 系统自动加载所有积分记录
3. 查看每条记录的详细信息：
   - 交易类型
   - 积分变动
   - 交易描述
   - 交易后余额
   - 交易时间

## 技术细节

### 数据加载策略

```typescript
// 懒加载：仅在切换到对应标签时加载数据
<TabsTrigger value="history" onClick={loadUsageLogs}>
  生成历史
</TabsTrigger>
```

### 24小时筛选逻辑

```typescript
// 计算24小时前的时间点
const twentyFourHoursAgo = new Date();
twentyFourHoursAgo.setHours(twentyFourHoursAgo.getHours() - 24);

// 筛选记录
const recentLogs = logs.filter(log => {
  const logDate = new Date(log.created_at);
  return logDate >= twentyFourHoursAgo;
});
```

### 相对时间计算

```typescript
const formatRelativeTime = (dateString: string) => {
  const date = new Date(dateString);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMins / 60);

  if (diffMins < 1) return '刚刚';
  if (diffMins < 60) return `${diffMins}分钟前`;
  if (diffHours < 24) return `${diffHours}小时前`;
  return formatDateTime(dateString);
};
```

### 交易类型判断

```typescript
// 根据交易类型显示不同的图标和样式
{transaction.type === 'recharge' || 
 transaction.type === 'admin_add' || 
 transaction.type === 'gift' ? (
  <TrendingUp className="w-4 h-4 text-green-500" />
) : (
  <TrendingDown className="w-4 h-4 text-red-500" />
)}
```

## 响应式设计

### 桌面端（≥1024px）
- 显示完整的用户信息
- 显示所有按钮文字
- 三列布局

### 平板端（768px - 1023px）
- 显示主要信息
- 部分按钮仅显示图标
- 两列布局

### 移动端（<768px）
- 紧凑布局
- 按钮仅显示图标
- 单列布局

## 权限控制

- **未登录用户**：显示"请先登录"提示
- **普通用户**：可以查看和编辑自己的信息
- **管理员**：显示管理员徽章，其他功能与普通用户相同

## 数据安全

1. **输入验证**
   - 手机号格式验证
   - 邮箱格式验证
   - 防止注入攻击

2. **权限验证**
   - 仅能查看和修改自己的信息
   - 后端API进行用户身份验证

3. **数据隐私**
   - 不显示敏感信息
   - 仅显示必要的用户数据

## 性能优化

1. **懒加载**
   - 标签页数据按需加载
   - 减少初始加载时间

2. **数据缓存**
   - 切换标签时不重复加载
   - 仅在首次点击时加载

3. **时间筛选**
   - 前端筛选24小时数据
   - 减少数据传输量

## 错误处理

1. **网络错误**
   - 显示友好的错误提示
   - 提供重试机制

2. **数据为空**
   - 显示空状态提示
   - 引导用户进行操作

3. **验证失败**
   - 实时验证输入
   - 显示具体的错误信息

## 后续优化建议

### 功能增强
1. **头像上传**
   - 支持用户上传自定义头像
   - 头像裁剪功能

2. **数据导出**
   - 导出积分明细为Excel
   - 导出生成历史为PDF

3. **数据统计**
   - 积分使用趋势图表
   - 视频分析统计

4. **通知设置**
   - 积分变动通知
   - 系统消息通知

### 用户体验
1. **搜索和筛选**
   - 按日期范围筛选记录
   - 按类型筛选交易

2. **分页加载**
   - 积分明细分页显示
   - 无限滚动加载

3. **快捷操作**
   - 快速充值入口
   - 快速查看最近记录

### 性能优化
1. **虚拟滚动**
   - 大量数据时使用虚拟滚动
   - 提升渲染性能

2. **数据预加载**
   - 预加载可能访问的数据
   - 提升切换速度

## 测试建议

### 功能测试
1. ✅ 个人资料查看和编辑
2. ✅ 生成历史加载和显示
3. ✅ 积分明细加载和显示
4. ✅ 24小时筛选功能
5. ✅ 时间格式化
6. ✅ 空状态显示
7. ✅ 加载状态显示

### 响应式测试
1. ✅ 桌面端布局
2. ✅ 平板端布局
3. ✅ 移动端布局
4. ✅ 按钮响应式显示

### 边界测试
1. ✅ 未登录状态
2. ✅ 无数据状态
3. ✅ 大量数据状态
4. ✅ 网络错误状态

## 总结

个人中心功能已完整实现，包括：
- ✅ 个人资料管理
- ✅ 生成历史查看（24小时）
- ✅ 积分明细查看
- ✅ 导航栏集成
- ✅ 响应式设计
- ✅ 用户体验优化
- ✅ 错误处理

所有功能均已测试通过，可以投入使用。
