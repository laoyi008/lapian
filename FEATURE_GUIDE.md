# 卡密系统使用指南

## 🎯 功能概述

本次更新为短视频拉片分析工具添加了完整的卡密兑换系统，让用户可以通过卡密快速充值积分。

## 📱 用户端功能

### 卡密兑换入口

1. **访问路径**：导航栏 → 积分充值
2. **页面位置**：积分充值页面的"卡密兑换"标签

### 使用步骤

1. 登录账号
2. 进入"积分充值"页面
3. 点击"卡密兑换"标签
4. 在输入框中输入卡密码（格式：XXXX-XXXX-XXXX-XXXX）
5. 点击"立即兑换"按钮
6. 兑换成功后，积分立即到账

### 功能特点

- ✨ 支持回车键快速兑换
- ✨ 自动转换为大写字母
- ✨ 实时验证卡密有效性
- ✨ 兑换成功后自动刷新积分余额
- ✨ 友好的错误提示

## 🔧 管理端功能

### 卡密管理入口

1. **访问路径**：管理后台 → 卡密管理标签
2. **权限要求**：仅管理员可访问

### 功能模块

#### 1. 卡密统计面板

显示以下统计信息：
- 总卡密数
- 未使用数量
- 已使用数量
- 总积分价值
- 已兑换积分

#### 2. 生成卡密

**操作步骤**：
1. 输入积分数量（例如：1000）
2. 输入生成数量（1-100）
3. 点击"生成卡密"按钮
4. 系统自动生成并显示在列表中

**生成规则**：
- 卡密格式：XXXX-XXXX-XXXX-XXXX
- 使用字符：A-Z（排除I、O）和2-9（排除0、1）
- 每个卡密唯一，不可重复

#### 3. 卡密列表

显示所有生成的卡密，包含以下信息：
- 卡密码（可一键复制）
- 积分数量
- 使用状态（未使用/已使用）
- 创建者
- 使用者
- 创建时间
- 使用时间

**操作功能**：
- 点击复制按钮快速复制卡密
- 查看卡密详细信息
- 筛选和排序

## 🔒 安全机制

### 数据安全

1. **行级安全（RLS）**：
   - 管理员可以查看和创建所有卡密
   - 普通用户只能查看自己使用过的卡密

2. **卡密唯一性**：
   - 每个卡密只能使用一次
   - 使用后立即标记为"已使用"状态

3. **事务保护**：
   - 使用数据库事务确保兑换过程的原子性
   - 防止并发兑换导致的重复使用

### 权限控制

- ✅ 只有管理员可以生成卡密
- ✅ 所有登录用户都可以兑换卡密
- ✅ 卡密兑换记录在积分交易中可追溯

## 💡 使用场景

### 场景1：批量充值

管理员可以批量生成卡密，分发给用户进行充值。

**示例**：
- 生成10个1000积分的卡密
- 通过微信/邮件发送给用户
- 用户自行兑换

### 场景2：促销活动

在营销活动中使用卡密作为奖励。

**示例**：
- 生成特定积分的卡密
- 作为活动奖品发放
- 用户兑换后可立即使用

### 场景3：代理分销

授权代理商销售卡密。

**示例**：
- 批量生成不同面额的卡密
- 提供给代理商销售
- 用户购买后自行兑换

## 📊 数据追踪

### 积分交易记录

每次卡密兑换都会在积分交易记录中留下痕迹：
- 交易类型：充值（recharge）
- 交易金额：卡密对应的积分
- 交易说明：卡密兑换 + 卡密码

### 卡密使用记录

管理员可以在卡密列表中查看：
- 哪些卡密已被使用
- 谁使用了卡密
- 什么时候使用的

## ⚠️ 注意事项

1. **卡密保管**：
   - 卡密一旦生成，请妥善保管
   - 不要将卡密泄露给他人
   - 建议通过安全渠道发送

2. **使用限制**：
   - 每个卡密只能使用一次
   - 已使用的卡密无法再次兑换
   - 卡密不区分大小写

3. **生成限制**：
   - 单次最多生成100个卡密
   - 积分数量必须大于0
   - 生成数量必须在1-100之间

## 🆘 常见问题

### Q1：卡密兑换失败怎么办？

**可能原因**：
- 卡密已被使用
- 卡密不存在
- 卡密格式错误
- 网络连接问题

**解决方法**：
- 检查卡密是否正确
- 确认卡密未被使用
- 联系客服获取帮助

### Q2：如何查看我使用过的卡密？

**方法**：
- 进入"我的"页面
- 查看积分交易记录
- 筛选"充值"类型的记录
- 查看备注中的卡密信息

### Q3：管理员如何导出卡密？

**方法**：
- 在卡密列表中选择需要导出的卡密
- 使用复制功能逐个复制
- 或使用浏览器的表格导出功能

## 📞 技术支持

如有任何问题，请联系：
- 客服微信：laoyi006
- 或在管理后台提交反馈
