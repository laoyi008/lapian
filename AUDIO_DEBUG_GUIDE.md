# 音频字幕识别调试指南

## 🎯 目的

帮助用户诊断为什么视频拉片分析时没有提取出字幕内容。

---

## 📋 调试步骤

### 第一步：打开浏览器控制台

1. 在浏览器中按 `F12` 或 `Ctrl+Shift+I`（Mac: `Cmd+Option+I`）
2. 切换到 **Console（控制台）** 标签
3. 清空之前的日志（点击🚫图标）

### 第二步：上传视频并开始分析

1. 上传一个包含人声的视频文件
2. 点击"开始分析"按钮
3. 观察控制台输出

### 第三步：查看音频分析日志

控制台会输出详细的音频分析过程，按以下顺序检查：

---

## 🔍 日志检查清单

### 1. 音频解码阶段

**期望看到：**
```
=== 开始音频分析 ===
视频时长: 120 秒
视频文件大小: 5242880 字节
视频文件已读取，大小: 5242880 字节
正在解码音频数据...
✅ 音频解码成功！
- 音频时长: 120 秒
- 采样率: 48000 Hz
- 声道数: 2
```

**如果看到错误：**
```
❌ 视频没有音频轨道或音频解析失败
```

**原因：** 视频文件没有音频轨道或音频格式不支持

**解决方案：**
- 确认视频文件包含音频
- 尝试使用其他视频文件
- 使用视频编辑软件重新编码视频

---

### 2. 音频提取阶段

**期望看到：**
```
正在提取音频，目标时长: 120 秒
✅ 音频提取完成！
- WAV文件大小: 3840000 字节
- WAV文件类型: audio/wav
```

**如果看到错误：**
```
❌ 音频提取失败
```

**原因：** 音频转换过程出错

**解决方案：**
- 检查浏览器是否支持Web Audio API
- 尝试使用Chrome或Edge浏览器
- 检查视频文件是否损坏

---

### 3. 音频分割阶段

**期望看到：**
```
正在分割音频，每段60秒...
✅ 音频分割完成，共 2 段
  - 第 1 段: 1920000 字节
  - 第 2 段: 1920000 字节
```

**如果段数为0：**

**原因：** 音频分割失败

**解决方案：**
- 检查音频文件大小是否正常
- 查看错误堆栈信息

---

### 4. 语音识别阶段

**期望看到（每段音频）：**
```
--- 识别第 1/2 段音频 ---
音频块大小: 1920000 字节
Base64编码长度: 2560000 字符
调用语音识别API...
API响应: {
  "status": 0,
  "msg": "success",
  "data": {
    "err_no": 0,
    "err_msg": "success.",
    "result": ["大家好，今天给大家介绍一款新产品"]
  }
}
- status: 0
- data.err_no: 0
- data.err_msg: success.
- data.result: ["大家好，今天给大家介绍一款新产品"]
✅ 第 1 段识别成功！
- 时间戳: 0秒
- 识别文本: "大家好，今天给大家介绍一款新产品"
- 文本长度: 18 字符
```

**如果看到：**
```
⚠️ 第 1 段音频无识别结果
- err_no: 3301
- err_msg: speech quality problem
```

**原因：** 音频质量问题或无人声

**可能的err_no值：**
- `3301`: 音频质量问题（可能是纯音乐、噪音过大、音量过小）
- `3302`: 鉴权失败
- `3303`: 语音服务器后端问题
- `3304`: 用户的请求QPS超限制
- `3305`: 用户的日pv（日请求量）超限制

**解决方案：**
- 确认视频中有清晰的人声
- 检查音频音量是否正常
- 避免背景音乐过大
- 使用标准普通话

**如果看到：**
```
❌ 识别第 1 段音频失败: 语音识别失败
```

**原因：** API调用失败

**解决方案：**
- 检查网络连接
- 查看完整的错误消息
- 检查API配置是否正确

---

### 5. 识别结果汇总

**期望看到：**
```
=== 音频识别完成 ===
识别出的字幕段数: 2
字幕内容: {
  "0": "大家好，今天给大家介绍一款新产品",
  "60": "这款产品采用了最新的技术，使用起来非常简单方便"
}
```

**如果字幕段数为0：**
```
⚠️ 未识别到任何语音内容
```

**原因：** 所有音频段都没有识别出内容

**解决方案：**
- 检查视频是否包含人声
- 查看每段音频的err_no和err_msg
- 尝试使用其他视频文件

---

## 🎬 测试视频要求

### 推荐的测试视频特征

✅ **好的测试视频：**
- 有清晰的人声对白或解说
- 音量适中，不要过小
- 背景音乐不要过大
- 使用标准普通话
- 语速适中，发音清晰
- 视频时长建议1-3分钟

❌ **不适合的测试视频：**
- 纯音乐视频（无人声）
- 背景音乐过大，人声不清晰
- 音量过小
- 方言或外语
- 多人同时说话
- 噪音过大

---

## 🔧 常见问题排查

### 问题1：视频有人声，但识别不出来

**检查项：**
1. 查看控制台中的 `err_no` 值
2. 如果是 `3301`（音频质量问题）：
   - 检查音频音量是否正常
   - 检查背景音乐是否过大
   - 尝试使用音频更清晰的视频

### 问题2：识别出的文字不准确

**原因：**
- 发音不清晰
- 有方言或口音
- 语速过快
- 背景噪音

**解决方案：**
- 使用标准普通话的视频
- 选择发音清晰的视频
- 后期可以手动修正识别结果

### 问题3：只识别出部分内容

**检查项：**
1. 查看控制台，确认哪些段识别成功，哪些失败
2. 检查失败段的 `err_no` 和 `err_msg`
3. 可能原因：
   - 某些时间段没有人声
   - 某些时间段音频质量差
   - 某些时间段是纯音乐

### 问题4：API调用失败

**检查项：**
1. 检查网络连接
2. 查看完整的错误消息
3. 检查浏览器控制台的Network标签，查看API请求状态
4. 确认API配置正确

---

## 📊 完整的调试日志示例

### 成功案例

```
=== 开始音频分析 ===
视频时长: 120 秒
视频文件大小: 5242880 字节
视频文件已读取，大小: 5242880 字节
正在解码音频数据...
✅ 音频解码成功！
- 音频时长: 120 秒
- 采样率: 48000 Hz
- 声道数: 2
正在提取音频，目标时长: 120 秒
✅ 音频提取完成！
- WAV文件大小: 3840000 字节
- WAV文件类型: audio/wav
正在分割音频，每段60秒...
✅ 音频分割完成，共 2 段
  - 第 1 段: 1920000 字节
  - 第 2 段: 1920000 字节
开始识别所有音频段...

--- 识别第 1/2 段音频 ---
音频块大小: 1920000 字节
Base64编码长度: 2560000 字符
调用语音识别API...
API响应: {
  "status": 0,
  "msg": "success",
  "data": {
    "corpus_no": "7368634167330515968",
    "err_no": 0,
    "err_msg": "success.",
    "sn": "123456789",
    "result": ["大家好，今天给大家介绍一款新产品，这款产品采用了最新的技术"]
  }
}
- status: 0
- data.err_no: 0
- data.err_msg: success.
- data.result: ["大家好，今天给大家介绍一款新产品，这款产品采用了最新的技术"]
✅ 第 1 段识别成功！
- 时间戳: 0秒
- 识别文本: "大家好，今天给大家介绍一款新产品，这款产品采用了最新的技术"
- 文本长度: 32 字符

--- 识别第 2/2 段音频 ---
音频块大小: 1920000 字节
Base64编码长度: 2560000 字符
调用语音识别API...
API响应: {
  "status": 0,
  "msg": "success",
  "data": {
    "corpus_no": "7368634167330515969",
    "err_no": 0,
    "err_msg": "success.",
    "sn": "123456790",
    "result": ["使用起来非常简单方便，欢迎大家购买体验"]
  }
}
- status: 0
- data.err_no: 0
- data.err_msg: success.
- data.result: ["使用起来非常简单方便，欢迎大家购买体验"]
✅ 第 2 段识别成功！
- 时间戳: 60秒
- 识别文本: "使用起来非常简单方便，欢迎大家购买体验"
- 文本长度: 21 字符

=== 音频识别完成 ===
识别出的字幕段数: 2
字幕内容: {
  "0": "大家好，今天给大家介绍一款新产品，这款产品采用了最新的技术",
  "60": "使用起来非常简单方便，欢迎大家购买体验"
}
```

### 失败案例（无人声）

```
=== 开始音频分析 ===
视频时长: 60 秒
视频文件大小: 2621440 字节
视频文件已读取，大小: 2621440 字节
正在解码音频数据...
✅ 音频解码成功！
- 音频时长: 60 秒
- 采样率: 48000 Hz
- 声道数: 2
正在提取音频，目标时长: 60 秒
✅ 音频提取完成！
- WAV文件大小: 1920000 字节
- WAV文件类型: audio/wav
正在分割音频，每段60秒...
✅ 音频分割完成，共 1 段
  - 第 1 段: 1920000 字节
开始识别所有音频段...

--- 识别第 1/1 段音频 ---
音频块大小: 1920000 字节
Base64编码长度: 2560000 字符
调用语音识别API...
API响应: {
  "status": 0,
  "msg": "success",
  "data": {
    "corpus_no": "7368634167330515970",
    "err_no": 3301,
    "err_msg": "speech quality problem",
    "sn": "123456791",
    "result": []
  }
}
- status: 0
- data.err_no: 3301
- data.err_msg: speech quality problem
- data.result: []
⚠️ 第 1 段音频无识别结果
- err_no: 3301
- err_msg: speech quality problem

=== 音频识别完成 ===
识别出的字幕段数: 0
字幕内容: {}
⚠️ 未识别到任何语音内容
```

---

## 💡 优化建议

### 1. 视频准备

- 使用高质量的音频录制设备
- 确保人声清晰，音量适中
- 减少背景噪音和音乐
- 使用标准普通话

### 2. 视频编辑

- 调整音频音量到合适范围
- 降低背景音乐音量
- 使用降噪工具处理音频
- 确保音频轨道正常

### 3. 测试流程

1. 先用短视频（30秒-1分钟）测试
2. 确认识别功能正常后再用长视频
3. 查看控制台日志了解识别情况
4. 根据err_no调整视频质量

---

## 📞 获取帮助

如果按照以上步骤仍然无法识别字幕，请：

1. **截图控制台完整日志**
   - 从"=== 开始音频分析 ==="开始
   - 到"=== 音频识别完成 ==="结束

2. **提供视频信息**
   - 视频时长
   - 视频大小
   - 是否有人声
   - 音频音量情况

3. **描述问题**
   - 看到的错误消息
   - err_no 和 err_msg
   - 预期结果 vs 实际结果

---

## ✅ 检查清单

使用以下清单确认每个步骤：

- [ ] 打开浏览器控制台
- [ ] 清空之前的日志
- [ ] 上传包含人声的视频
- [ ] 点击"开始分析"
- [ ] 查看"音频解码成功"
- [ ] 查看"音频提取完成"
- [ ] 查看"音频分割完成"
- [ ] 查看每段音频的识别结果
- [ ] 检查err_no是否为0
- [ ] 确认识别出的字幕内容
- [ ] 查看"音频识别完成"的统计

---

## 🎉 成功标志

当你看到以下内容时，说明音频识别成功：

```
✅ 音频识别完成，共识别出 X 段字幕
```

并且在分析结果表格中，**字幕内容**列显示了实际的文字内容，而不是"-"。

---

**文档版本：** v1.0  
**创建日期：** 2025-12-03  
**适用版本：** v2.4+
